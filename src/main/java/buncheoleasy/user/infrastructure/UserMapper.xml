<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="buncheoleasy.user.infrastructure.UserMapper">

    <!-- User ResultMap -->
    <resultMap id="userResultMap" type="User">
        <constructor>
            <idArg column="id" javaType="Long"/>
            <arg column="provider" javaType="String"/>
            <arg column="provider_id" javaType="String"/>
            <arg column="nickname" javaType="String"/>
            <arg column="email" javaType="String"/>
            <arg column="phone_number" javaType="String"/>
            <arg column="created_at" javaType="java.time.LocalDateTime"/>
            <arg column="updated_at" javaType="java.time.LocalDateTime"/>
            <arg column="deleted_at" javaType="java.time.LocalDateTime"/>
        </constructor>
    </resultMap>

    <!-- 유저 저장 -->
    <insert id="insert" parameterType="User"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO users (provider,
                           provider_id,
                           nickname,
                           email,
                           phone_number,
                           created_at,
                           updated_at)
        VALUES (#{socialInfo.provider.value},
                #{socialInfo.providerId},
                #{nickname.value},
                #{email.value},
                #{phoneNumber.value},
                NOW(),
                NOW())
    </insert>

    <!-- ID로 유저 조회 -->
    <select id="findById" resultMap="userResultMap">
        SELECT id,
               provider,
               provider_id,
               nickname,
               email,
               phone_number,
               created_at,
               updated_at,
               deleted_at
        FROM users
        WHERE id = #{id}
          AND deleted_at IS NULL
    </select>

</mapper>
